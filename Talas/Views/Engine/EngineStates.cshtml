@using System
@using System.Globalization
@model System.Collections.Generic.IEnumerable<Objects.EngineState>

@{  
    const String valueON = "ON";
    const String valueOFF = "OFF";
    const String valueHigh = "High";

    const String formatClampValue = "0.0000";
}

<div class="pre-scrollable engineStates">
    <table class="table text-left">
        <thead>
            <tr>
                <th>Date & Time</th>
                <th>
                    @ViewBag.ModeName
                    @if (ViewBag.IsClamp != null && ViewBag.IsClamp)
                    {
                        <h6>(Average 30s)</h6>
                    }
                </th>
                @if (ViewBag.IsClamp != null && ViewBag.IsClamp)
                {
                    <th>Instant Leakage Current, mA</th>
                }
                @if ((Byte)ViewBag.Mode == 4)
                {
                    if (ViewBag.IsTes)
                    {
                        <th>Polarization Index R60</th>

                    }
                    <th>DAR (R60/R30)</th>
                    <th>R5</th>
                    <th>R30</th>
                    <th>R60</th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var es in Model)
            {
                <tr>
                    <td><span>@es.DateString</span></td>
                    <td>
                        <span>
                            @switch ((Byte)ViewBag.Mode)
                            {
                                case 2:
                                    @((es.Work == null)? valueOFF: (Boolean)es.Work ? valueON : valueOFF)
                                    break;
                                case 3:
                                    if (ViewBag.IsClamp)
                                     {
                                        @(((Double)es.Value/1000).ToString(formatClampValue))
                                    }
                                    else
                                    {
                                        if (ViewBag.IsTes)
                                        {
                                            @(es.Value > 1000000 ? valueHigh : es.Value.ToString())
                                        }
                                        else
                                        {
                                            @(es.Value > 20000 ? valueHigh : es.Value.ToString())
                                        }
                                    }
                                    break;
                                case 4:
                                    if (ViewBag.IsTes)
                                    {/*Polarization Index R30*/
                                        @((es.Value != null && es.R30 != null) ? (Single)es.R30 / (Single)es.Value : 0)
                                    }
                                    else
                                    {
                                        @((es.R60 != null && es.R5 != null) ? (Single)es.R60 / (Single)es.R5 : 0)
                                    }
                                    break;
                                case 5:
                                    @((Boolean)es.Status ? valueON : valueOFF)
                                    break;
                                    case 6:
                                    @( es.Status_M == null ? valueOFF:(Boolean)es.Status_M ? valueON : valueOFF)
                                    break;
                            }
                        </span>
                    </td>
                    @if (ViewBag.IsClamp != null && ViewBag.IsClamp)
                    {
                        <td>
                            <span>@es.LeakageCurrent.ToString(formatClampValue)</span>
                        </td>
                    }
                    @if ((Byte)ViewBag.Mode == 4)
                    {
                        if (ViewBag.IsTes)
                        {/*Polarization Index R60*/
                            <td>
                                <span>@((es.Value != null && es.R60 != null) ? (Single) es.R60/(Single) es.Value : 0)</span>
                            </td>
                        }
                        <td>
                            @*DAR (R60/R30)*@
                            <span>@((es.R30 != null && es.R60 != null) ? (Single)es.R60 / (Single)es.R30 : 0)</span>
                        </td>
                        <td>
                            @*R0 OR R5*@
                        <span>@(ViewBag.IsTes ? es.Value : es.R5)</span>
                        </td>
                        <td>
                            <span>@es.R30</span>
                        </td>
                        <td>
                            <span>@es.R60</span>
                        </td>
                    }
                </tr>
            }
        </tbody>
    </table>
</div>

@if (ViewBag.WorkTimes != null)
{
    <input type="hidden" name="work" value=@ViewBag.WorkTimes>
    <input type="hidden" name="notWork" value=@ViewBag.NotWorkTimes>
}